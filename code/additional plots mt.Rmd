---
title: "Plots MT"
author: "Raphael Kroes"
date: "2023-11-22"
output: html_document
---

```{r}
#Heatwaves: 97% quantile

library(ggplot2)
wetter.baiersbronn <- read.csv("C:/Users/Raphael (limited)/Desktop/Master Thesis/weather data/wetter baiersbronn.csv")
row.selector<- 13+seq(0,365*24, by=24)
temperatures<- as.numeric(wetter.baiersbronn$temperature_2m...C.[row.selector])
dates<- as.Date(substr(wetter.baiersbronn$time[row.selector],1,10))
df<- data.frame(date = dates, temperature = temperatures)
threshold <- quantile(df$temperature, 0.95)
plot_1 <- ggplot(df, aes(x = date, y = temperature)) +
  geom_line() +  # Add a line to connect the points
  labs(title = "Temperature Time Series",
       x = "Date",
       y = "Temperature (in degrees)") +
  theme_minimal()  # Customize the theme if needed

plot_2 <- ggplot(df, aes(x = date, y = temperature, fill = temperature > threshold)) +
  geom_bar(stat = "identity") +  # Create a bar plot
  scale_fill_manual(values = c("skyblue", "red"),
                    name = "Temperature regime",
                    labels = c("temperatures below 95% quantile", "temperatures above 95% quantile")) +  # Set fill colors, legend title, and labels
  labs(title = "Daily Ambient Temperature in Baiersbronn, 2016",
       x = "Date",
       y = "Temperature (in degrees)") +
  theme_minimal() +  # Customize the theme if needed
  theme(legend.position = "bottom")
print(plot_1)
print(plot_2)
```
```{r}
#######descriptive plots#######

library(ggplot2)
############## TO DO ##############
# Weather Plots
# Daylight Plots
# Age distribution
# (unbalanced?) distribution of disease category
# SDI param plots: daily effect (3d) & accumulated effects

#prepare data

n<- length(levels(full.df_7$week))
sel.quantiles_age<- c(0.05,0.25,0.5,0.75,0.95)
age.matrix<- matrix(NA, nrow = n, ncol = length(sel.quantiles_age))
colnames(age.matrix)<- paste0("age_q_",sel.quantiles_age)
gender.vec<- numeric(n)
phi.vec<- numeric(n)
sel.quantiles_chronic<- c(0.05,0.25,0.5,0.75,0.95)
chronic.matrix<- matrix(NA, nrow = n, ncol = length(sel.quantiles_chronic))
colnames(chronic.matrix)<- paste0("chronic_q_",sel.quantiles_chronic)
mean.temperature<- numeric(n)

for(i in seq(1,n)){
  im<- full.df_7|>
    filter(week==levels(full.df_7$week)[i])
  age.matrix[i,]<- quantile(im$age,probs = sel.quantiles_age)
  gender.vec[i]<- mean(im$female)
  phi.vec[i]<- mean(im$PKV)
  chronic.matrix[i,]<- quantile(im$no_all_chronic_diseases, probs = sel.quantiles_chronic)
  mean.temperature[i]<- mean(im$daily_mean_temperature_kelvin)
}

df<- as.data.frame(cbind(as.numeric(levels(full.df_7$week)),
                         age.matrix,
                         gender.vec,
                         phi.vec,
                         chronic.matrix,
                         mean.temperature-273.16))
colnames(df)[1]<- "week"
colnames(df)[14]<- "mean.temperature"

# Define the colours for the quantiles
colours <- c("#FFD6D6", "#FFADAD", "#FF8585", "#FF5C5C", "#FF3333")

# Create the plot
ggplot(df, aes(x = week)) +
  geom_ribbon(aes(ymin = age_q_0.05, ymax = age_q_0.25, fill = "0.05-0.25"), alpha = 0.8, colour = NA) +
  geom_ribbon(aes(ymin = age_q_0.25, ymax = age_q_0.5, fill = "0.25-0.5"), alpha = 0.8, colour = NA) +
  geom_ribbon(aes(ymin = age_q_0.5, ymax = age_q_0.75, fill = "0.5-0.75"), alpha = 0.8, colour = NA) +
  geom_ribbon(aes(ymin = age_q_0.75, ymax = age_q_0.95, fill = "0.75-0.95"), alpha = 0.8, colour = NA) +
  scale_fill_manual(values = colours, guide = FALSE) +
  theme_minimal() +
  labs(x = "Week", y = "Value") +
  ggtitle("Age Quantiles by Week") +
  theme(plot.title = element_text(hjust = 0.5))

library(ggplot2)

# Define the colours for the quantiles
colours <- c("#FFD6D6", "#FFADAD", "#FF8585", "#FF5C5C", "#FF3333")

# Create the plot
ggplot(df, aes(x = week)) +
  # geom_ribbon(aes(ymin = age_q_0.05, ymax = age_q_0.25, fill = "0.05-0.25"), alpha = 0.8, colour = NA) +
  # geom_ribbon(aes(ymin = age_q_0.25, ymax = age_q_0.5, fill = "0.25-0.5"), alpha = 0.8, colour = NA) +
  # geom_ribbon(aes(ymin = age_q_0.5, ymax = age_q_0.75, fill = "0.5-0.75"), alpha = 0.8, colour = NA) +
  # geom_ribbon(aes(ymin = age_q_0.75, ymax = age_q_0.95, fill = "0.75-0.95"), alpha = 0.8, colour = NA) +
  geom_line(aes(y = age_q_0.05), colour = "blue", linewidth = 1.1) +
  geom_line(aes(y = age_q_0.25), colour = "green", linewidth = 1.1) +
  geom_line(aes(y = age_q_0.5), colour = "black", linewidth = 1.1) +
  geom_line(aes(y = age_q_0.75), colour = "green", linewidth = 1.1) +
  geom_line(aes(y = age_q_0.95), colour = "blue", linewidth = 1.1) +
  scale_fill_manual(values = colours, guide = FALSE) +
  scale_x_continuous(name = "week", breaks = c(1,seq(4,53,by=4))) +
  theme_minimal() +
  labs(x = "Week", y = "Age") +
  ggtitle("Age Quantiles by Week") +
  theme(plot.title = element_text(hjust = 0.5)) 

ggplot(df, aes(x = week)) +
  geom_line(aes(y = mean.temperature), colour = "black") +  
  scale_x_continuous(name = "week", breaks = c(1,seq(4,53,by=4))) +
  scale_fill_manual(values = colours, guide = FALSE) +
  theme_minimal() +
  labs(x = "Week", y = "Temperature in Â°C") +
  ggtitle("Temperature by Week") +
  theme(plot.title = element_text(hjust = 0.5)) 

```
```{r}
### Harvesting simulation

n_mc<- 60
patients<- 1000
p_disease<- function(k) ifelse(k > 10 & k <= 20, 0.055, 0.05)
p_recovery<- 0.2
healthy<- numeric(n_mc)
diseased<- numeric(n_mc)
healthy[1]<- 800
diseased[1]<- 200
for(i in seq(2, n_mc)){
  recovered<- diseased[i - 1] * p_recovery
  fallen<- healthy[i - 1] * p_disease(i)
  healthy[i]<- healthy[i - 1] - fallen + recovered
  diseased[i]<- patients - healthy[1]
}
plot.ts(healthy)

weather<- numeric(n_mc)
weather[11:20]<- 1
DI<- function(w) 
  
  
n_mc<- 21
patients<- 1000
p_disease<- function(k) ifelse(k == 11, 0.1, 0.05)
p_recovery<- 0.2
healthy<- numeric(n_mc)
diseased<- numeric(n_mc)
healthy[1]<- 800
diseased[1]<- 200
for(i in seq(2, n_mc)){
  recovered<- diseased[i - 1] * p_recovery
  fallen<- healthy[i - 1] * p_disease(i)
  healthy[i]<- healthy[i - 1] - fallen + recovered
  diseased[i]<- patients - healthy[1]
}
plot.ts(healthy)

DI<- unlist(sapply(seq(1, n_mc), p_disease))

```

```{r}
####harvest effect simulation

n<- 1000
p_disease<- 0.1
p_recovery<- 0.2
n_mc<- 1000
healthy<- numeric(n_mc)
diseased<- numeric(n_mc)
healthy[1]<- 800
diseased[1]<- 200
set.seed(84641)
for(i in seq(2, n_mc)){
  if(i > 10) p_disease<- 0.05
  fallen<- healthy[i - 1] * p_disease #sum(runif(healthy[i - 1]) <= p_disease)
  recovered<- diseased[i - 1] * p_recovery #sum(runif(diseased[i - 1]) <= p_recovery)
  healthy[i]<- healthy[i - 1] - fallen + recovered
  diseased[i]<- n - healthy[i]
}
plot.ts(healthy[1:20])
plot.ts(diseased[1:20])
plot(diseased[1:20]~seq(1, 20), ylim = c(200, 350), xlab = "Time", ylab = "number of disease individuals", las = 1, type = "l")
```

